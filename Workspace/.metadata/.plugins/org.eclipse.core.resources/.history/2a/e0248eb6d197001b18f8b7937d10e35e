package com.staykeep.daoimpl;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import com.staykeep.dao.GuestDao;
import com.staykeep.mapper.GuestRowMapper;
import com.staykeep.pojo.Guest;

//Implementation for handling Database functions concerning Guest objects.
@Repository
public class GuestDaoImpl implements GuestDao {

	// JDBC Template to use for database connection.
	private JdbcTemplate jdbcTemplate;

	// GuestRowMapper to return Guest objects from database.
	private GuestRowMapper guestRowMapper;

	// Auto-wired JDBC Template setter --> nothing calls this.
	@Autowired
	public void setJdbcTemplate(JdbcTemplate jdbcTemplate) {
		this.jdbcTemplate = jdbcTemplate;
	}

	// Auto-wired GuestRowMapper setter --> nothing calls this.
	@Autowired
	public void setGuestRowMapper(GuestRowMapper guestRowMapper) {
		this.guestRowMapper = guestRowMapper;
	}

//-------------------------------------------------------------------------------------------------------

	// Implementation of a abstract method that returns a list of all guests.
	@Override
	public List<Guest> getAllGuests() {
		String sql = "SELECT g_id, f_name, l_name, cc_num FROM guest";
		List<Guest> guestList = jdbcTemplate.query(sql, guestRowMapper);
		return guestList;
	}

	// Implementation of a abstract method that
	// gets all values of a guest object given the id.
	// Returns a Guest object with all values.
	@Override
	public Guest getGuestInfoById(int g_id) {
		String sql = "SELECT g_id, f_name, l_name, cc_num FROM guest WHERE g_id = ?";
		List<Guest> guestList = jdbcTemplate.query(sql, guestRowMapper, g_id);
		return guestList.get(0);
	}

	// Implementation of a abstract method that creates a new guest.
	// Returns TRUE if successful.
	@Override
	public boolean createNewGuest(Guest guest) {
		String f_name = guest.getF_name();
		String l_name = guest.getL_name();
		String cc_num = guest.getCc_num();
		String sql = "INSERT INTO guest (f_name, l_name, cc_num) VALUES ( ?, ?, ? )";
		Object[] args = new Object[] { f_name, l_name, cc_num };
		return jdbcTemplate.update(sql, args) == 1;
	}

	// Implementation of a abstract method that deletes a guest by id.
	// Returns TRUE if successful.
	@Override
	public boolean deleteGuest(int g_id) {
		String sql = "DELETE FROM guest WHERE g_id = ?";
		Object[] args = new Object[] { g_id };
		return jdbcTemplate.update(sql, args) == 1;
	}

	// Implementation of a abstract method that sets a guest's first name by id.
	// Returns TRUE if successful.
	@Override
	public void setGuestFname(Guest guest) {
		
		String f_name  = guest.getF_name();
		int g_id = guest.getG_id();
		String sql = "UPDATE guest SET f_name = ? WHERE g_id = ?";
		Object[] args = new Object[] { f_name, g_id };
		jdbcTemplate.update(sql, args);
	}

	// Implementation of a abstract method that sets a guest's last name by id.
	// Returns TRUE if successful.
	@Override
	public boolean setGuestLname(String l_name, int g_id) {
		String sql = "UPDATE guest SET l_name = ? WHERE g_id = ?";
		Object[] args = new Object[] { l_name, g_id };
		return jdbcTemplate.update(sql, args) == 1;
	}

	// Implementation of a abstract method that sets a guest's credit card number by id.
	// Returns TRUE if successful.
	@Override
	public boolean setGuestCcnum(String cc_num, int g_id) {
		String sql = "UPDATE guest SET cc_num = ? WHERE g_id = ?";
		Object[] args = new Object[] { cc_num, g_id };
		return jdbcTemplate.update(sql, args) == 1;
	}
}
